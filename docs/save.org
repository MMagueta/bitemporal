* Save operation

This command should persist the desired data onto the main table,
archiving any delete needed.

** API

| Parameter  | Type  | Description | Example |
| fields     | text  |             |         |
| values     | text  |             |         |
| valid time | range |             |         |
| where      | text  |             |         |

** Tests

In order to have a good start for this project, we start by planning
all cases that should be handled by each DML operation. Later on we
shall evolve this truth tables for more complex operations.

/Test:/ identifier for a test with pattern: ~Tn~, where ~n~ is a
natural number, zero padded to the length of the biggest ~n~.

/Group:/ Name for a test group. Values: ~INSERT~.

/Condition:/ What is the resulting condition after the operation.
See: TBD.

/Possible?:/ Since we are listing every possible combination, we might
end up with impossible scenarios. This column denotes if a scenario
can happen.

/Actions:/ Describe what operations we shall execute for a given
scenario. see TBD.

~INSERT:~ Simply insert a row.

~ARCHIVE-C:~ Move rows connected to the test row to the history table.

~MERGE-INSERT:~ Merge rows connected to the test row and insert.

#+NAME: truth-table
| Test | Possible? | Command | Rows | ROW4         | ROW3         | ROW2         | ROW1         | Actions                                                 |
|------+-----------+---------+------+--------------+--------------+--------------+--------------+---------------------------------------------------------|
|    1 |           | SAVE    |    0 |              |              |              |              | INSERT                                                  |
|    2 |           | SAVE    |    1 |              |              |              | Overlapped   | ARCHIVE-OVERLAPPED, INSERT NEW, INSERT OVERLAPPED - NEW |
|    3 |           | SAVE    |    1 |              |              |              | Connected    | ARCHIVE-CONNECTED, MERGE-INSERT                         |
|    4 |           | SAVE    |    1 |              |              |              | Disconnected | INSERT                                                  |
|    5 |           | SAVE    |    2 |              |              | Overlapped   | Overlapped   | ARCHIVE-OVERLAPPED, INSERT NEW, INSERT OVERLAPPED - NEW |
|    6 |           | SAVE    |    2 |              |              | Overlapped   | Connected    |                                                         |
|    7 |           | SAVE    |    2 |              |              | Overlapped   | Disconnected |                                                         |
|    8 |           | SAVE    |    2 |              |              | Connected    | Overlapped   |                                                         |
|    9 |           | SAVE    |    2 |              |              | Connected    | Connected    |                                                         |
|   10 |           | SAVE    |    2 |              |              | Connected    | Disconnected |                                                         |
|   11 |           | SAVE    |    2 |              |              | Disconnected | Overlapped   |                                                         |
|   12 |           | SAVE    |    2 |              |              | Disconnected | Connected    |                                                         |
|   13 |           | SAVE    |    2 |              |              | Disconnected | Disconnected | INSERT                                                  |
|   14 |           | SAVE    |    3 |              | Overlapped   | Overlapped   | Overlapped   |                                                         |
|   15 |           | SAVE    |    3 |              | Overlapped   | Overlapped   | Connected    |                                                         |
|   16 |           | SAVE    |    3 |              | Overlapped   | Overlapped   | Disconnected |                                                         |
|   17 |           | SAVE    |    3 |              | Overlapped   | Connected    | Overlapped   |                                                         |
|   18 |           | SAVE    |    3 |              | Overlapped   | Connected    | Connected    |                                                         |
|   19 |           | SAVE    |    3 |              | Overlapped   | Connected    | Disconnected |                                                         |
|   20 |           | SAVE    |    3 |              | Overlapped   | Disconnected | Overlapped   |                                                         |
|   21 |           | SAVE    |    3 |              | Overlapped   | Disconnected | Connected    |                                                         |
|   22 |           | SAVE    |    3 |              | Overlapped   | Disconnected | Disconnected |                                                         |
|   23 |           | SAVE    |    3 |              | Connected    | Overlapped   | Overlapped   |                                                         |
|   24 |           | SAVE    |    3 |              | Connected    | Overlapped   | Connected    |                                                         |
|   25 |           | SAVE    |    3 |              | Connected    | Overlapped   | Disconnected |                                                         |
|   26 |           | SAVE    |    3 |              | Connected    | Connected    | Overlapped   |                                                         |
|   27 | NO        | SAVE    |    3 |              | Connected    | Connected    | Connected    | -                                                       |
|   28 |           | SAVE    |    3 |              | Connected    | Connected    | Disconnected |                                                         |
|   29 |           | SAVE    |    3 |              | Connected    | Disconnected | Overlapped   |                                                         |
|   30 |           | SAVE    |    3 |              | Connected    | Disconnected | Connected    |                                                         |
|   31 |           | SAVE    |    3 |              | Connected    | Disconnected | Disconnected |                                                         |
|   32 |           | SAVE    |    3 |              | Disconnected | Overlapped   | Overlapped   |                                                         |
|   33 |           | SAVE    |    3 |              | Disconnected | Overlapped   | Connected    |                                                         |
|   34 |           | SAVE    |    3 |              | Disconnected | Overlapped   | Disconnected |                                                         |
|   35 |           | SAVE    |    3 |              | Disconnected | Connected    | Overlapped   |                                                         |
|   36 |           | SAVE    |    3 |              | Disconnected | Connected    | Connected    |                                                         |
|   37 |           | SAVE    |    3 |              | Disconnected | Connected    | Disconnected |                                                         |
|   38 |           | SAVE    |    3 |              | Disconnected | Disconnected | Overlapped   |                                                         |
|   39 |           | SAVE    |    3 |              | Disconnected | Disconnected | Connected    |                                                         |
|   40 |           | SAVE    |    3 |              | Disconnected | Disconnected | Disconnected | INSERT                                                  |
|   41 |           | SAVE    |    4 | Overlapped   | Overlapped   | Overlapped   | Overlapped   |                                                         |
|   42 |           | SAVE    |    4 | Overlapped   | Overlapped   | Overlapped   | Connected    |                                                         |
|   43 |           | SAVE    |    4 | Overlapped   | Overlapped   | Overlapped   | Disconnected |                                                         |
|   44 |           | SAVE    |    4 | Overlapped   | Overlapped   | Connected    | Overlapped   |                                                         |
|   45 |           | SAVE    |    4 | Overlapped   | Overlapped   | Connected    | Connected    |                                                         |
|   46 |           | SAVE    |    4 | Overlapped   | Overlapped   | Connected    | Disconnected |                                                         |
|   47 |           | SAVE    |    4 | Overlapped   | Overlapped   | Disconnected | Overlapped   |                                                         |
|   48 |           | SAVE    |    4 | Overlapped   | Overlapped   | Disconnected | Connected    |                                                         |
|   49 |           | SAVE    |    4 | Overlapped   | Overlapped   | Disconnected | Disconnected |                                                         |
|   50 |           | SAVE    |    4 | Overlapped   | Connected    | Overlapped   | Overlapped   |                                                         |
|   51 |           | SAVE    |    4 | Overlapped   | Connected    | Overlapped   | Connected    |                                                         |
|   52 |           | SAVE    |    4 | Overlapped   | Connected    | Overlapped   | Disconnected |                                                         |
|   53 |           | SAVE    |    4 | Overlapped   | Connected    | Connected    | Overlapped   |                                                         |
|      | NO        | SAVE    |    4 | Overlapped   | Connected    | Connected    | Connected    | -                                                       |
|   55 |           | SAVE    |    4 | Overlapped   | Connected    | Connected    | Disconnected |                                                         |
|   56 |           | SAVE    |    4 | Overlapped   | Connected    | Disconnected | Overlapped   |                                                         |
|   57 |           | SAVE    |    4 | Overlapped   | Connected    | Disconnected | Connected    |                                                         |
|   58 |           | SAVE    |    4 | Overlapped   | Connected    | Disconnected | Disconnected |                                                         |
|   59 |           | SAVE    |    4 | Overlapped   | Disconnected | Overlapped   | Overlapped   |                                                         |
|   60 |           | SAVE    |    4 | Overlapped   | Disconnected | Overlapped   | Connected    |                                                         |
|   61 |           | SAVE    |    4 | Overlapped   | Disconnected | Overlapped   | Disconnected |                                                         |
|   62 |           | SAVE    |    4 | Overlapped   | Disconnected | Connected    | Overlapped   |                                                         |
|   63 |           | SAVE    |    4 | Overlapped   | Disconnected | Connected    | Connected    |                                                         |
|   64 |           | SAVE    |    4 | Overlapped   | Disconnected | Connected    | Disconnected |                                                         |
|   65 |           | SAVE    |    4 | Overlapped   | Disconnected | Disconnected | Overlapped   |                                                         |
|   66 |           | SAVE    |    4 | Overlapped   | Disconnected | Disconnected | Connected    |                                                         |
|   67 |           | SAVE    |    4 | Overlapped   | Disconnected | Disconnected | Disconnected |                                                         |
|   68 |           | SAVE    |    4 | Connected    | Overlapped   | Overlapped   | Overlapped   |                                                         |
|   69 |           | SAVE    |    4 | Connected    | Overlapped   | Overlapped   | Connected    |                                                         |
|   70 |           | SAVE    |    4 | Connected    | Overlapped   | Overlapped   | Disconnected |                                                         |
|   71 |           | SAVE    |    4 | Connected    | Overlapped   | Connected    | Overlapped   |                                                         |
|      | NO        | SAVE    |    4 | Connected    | Overlapped   | Connected    | Connected    | -                                                       |
|   72 |           | SAVE    |    4 | Connected    | Overlapped   | Connected    | Disconnected |                                                         |
|   73 |           | SAVE    |    4 | Connected    | Overlapped   | Disconnected | Overlapped   |                                                         |
|   74 |           | SAVE    |    4 | Connected    | Overlapped   | Disconnected | Connected    |                                                         |
|   75 |           | SAVE    |    4 | Connected    | Overlapped   | Disconnected | Disconnected |                                                         |
|   76 |           | SAVE    |    4 | Connected    | Connected    | Overlapped   | Overlapped   |                                                         |
|   77 |           | SAVE    |    4 | Connected    | Connected    | Overlapped   | Connected    |                                                         |
|   78 |           | SAVE    |    4 | Connected    | Connected    | Overlapped   | Disconnected |                                                         |
|      | NO        | SAVE    |    4 | Connected    | Connected    | Connected    | Overlapped   | -                                                       |
|      | NO        | SAVE    |    4 | Connected    | Connected    | Connected    | Connected    | -                                                       |
|      | NO        | SAVE    |    4 | Connected    | Connected    | Connected    | Disconnected | -                                                       |
|   79 |           | SAVE    |    4 | Connected    | Connected    | Disconnected | Overlapped   |                                                         |
|      | NO        | SAVE    |    4 | Connected    | Connected    | Disconnected | Connected    | -                                                       |
|   80 |           | SAVE    |    4 | Connected    | Connected    | Disconnected | Disconnected |                                                         |
|   81 |           | SAVE    |    4 | Connected    | Disconnected | Overlapped   | Overlapped   |                                                         |
|   82 |           | SAVE    |    4 | Connected    | Disconnected | Overlapped   | Connected    |                                                         |
|   83 |           | SAVE    |    4 | Connected    | Disconnected | Overlapped   | Disconnected |                                                         |
|   84 |           | SAVE    |    4 | Connected    | Disconnected | Connected    | Overlapped   |                                                         |
|      | NO        | SAVE    |    4 | Connected    | Disconnected | Connected    | Connected    | -                                                       |
|   85 |           | SAVE    |    4 | Connected    | Disconnected | Connected    | Disconnected |                                                         |
|   86 |           | SAVE    |    4 | Connected    | Disconnected | Disconnected | Overlapped   |                                                         |
|   87 |           | SAVE    |    4 | Connected    | Disconnected | Disconnected | Connected    |                                                         |
|   88 |           | SAVE    |    4 | Connected    | Disconnected | Disconnected | Disconnected |                                                         |
|   89 |           | SAVE    |    4 | Disconnected | Overlapped   | Overlapped   | Overlapped   |                                                         |
|   90 |           | SAVE    |    4 | Disconnected | Overlapped   | Overlapped   | Connected    |                                                         |
|   91 |           | SAVE    |    4 | Disconnected | Overlapped   | Overlapped   | Disconnected |                                                         |
|   92 |           | SAVE    |    4 | Disconnected | Overlapped   | Connected    | Overlapped   |                                                         |
|   93 |           | SAVE    |    4 | Disconnected | Overlapped   | Connected    | Connected    |                                                         |
|   94 |           | SAVE    |    4 | Disconnected | Overlapped   | Connected    | Disconnected |                                                         |
|   95 |           | SAVE    |    4 | Disconnected | Overlapped   | Disconnected | Overlapped   |                                                         |
|   96 |           | SAVE    |    4 | Disconnected | Overlapped   | Disconnected | Connected    |                                                         |
|   97 |           | SAVE    |    4 | Disconnected | Overlapped   | Disconnected | Disconnected |                                                         |
|   98 |           | SAVE    |    4 | Disconnected | Connected    | Overlapped   | Overlapped   |                                                         |
|   99 |           | SAVE    |    4 | Disconnected | Connected    | Overlapped   | Connected    |                                                         |
|  100 |           | SAVE    |    4 | Disconnected | Connected    | Overlapped   | Disconnected |                                                         |
|  101 |           | SAVE    |    4 | Disconnected | Connected    | Connected    | Overlapped   |                                                         |
|      | NO        | SAVE    |    4 | Disconnected | Connected    | Connected    | Connected    | -                                                       |
|  102 |           | SAVE    |    4 | Disconnected | Connected    | Connected    | Disconnected |                                                         |
|  103 |           | SAVE    |    4 | Disconnected | Connected    | Disconnected | Overlapped   |                                                         |
|  104 |           | SAVE    |    4 | Disconnected | Connected    | Disconnected | Connected    |                                                         |
|  105 |           | SAVE    |    4 | Disconnected | Connected    | Disconnected | Disconnected |                                                         |
|  106 |           | SAVE    |    4 | Disconnected | Disconnected | Overlapped   | Overlapped   |                                                         |
|  107 |           | SAVE    |    4 | Disconnected | Disconnected | Overlapped   | Connected    |                                                         |
|  108 |           | SAVE    |    4 | Disconnected | Disconnected | Overlapped   | Disconnected |                                                         |
|  109 |           | SAVE    |    4 | Disconnected | Disconnected | Connected    | Overlapped   |                                                         |
|  110 |           | SAVE    |    4 | Disconnected | Disconnected | Connected    | Connected    |                                                         |
|  111 |           | SAVE    |    4 | Disconnected | Disconnected | Connected    | Disconnected |                                                         |
|  112 |           | SAVE    |    4 | Disconnected | Disconnected | Disconnected | Overlapped   |                                                         |
|  113 |           | SAVE    |    4 | Disconnected | Disconnected | Disconnected | Connected    |                                                         |
|  114 |           | SAVE    |    4 | Disconnected | Disconnected | Disconnected | Disconnected | INSERT                                                  |






#+BEGIN_SRC plantuml :file test.svg
  @startgantt
  scale 2
  [separated1] lasts 5 days
  [separated2] lasts 5 days
  [connected1] lasts 5 days
  [connected2] lasts 5 days
  [overlapped1] lasts 10 days
  [overlapped2] lasts 10 days
  [target] lasts 30 days
  [overlapped3] lasts 10 days
  [overlapped4] lasts 10 days
  [connected3] lasts 5 days
  [connected4] lasts 5 days
  [separated3] lasts 5 days
  [separated4] lasts 5 days

  [separated1]  starts D+0
  [separated2]  starts D+10
  [connected1]  starts D+20
  [connected2]  starts D+20
  [overlapped1] starts D+20
  [overlapped2] starts D+30
  [target]      starts D+25
  [overlapped3] starts D+40
  [overlapped4] starts D+50
  [connected3]  starts D+55
  [connected4]  starts D+55
  [separated3]  starts D+65
  [separated4]  starts D+75

  [separated2] displays on same row as [separated1]
  [separated3] displays on same row as [separated1]
  [separated4] displays on same row as [separated1]

  [connected3] displays on same row as [connected1]
  [connected4] displays on same row as [connected2]

  [overlapped2] displays on same row as [overlapped1]
  [overlapped3] displays on same row as [overlapped1]
  [overlapped4] displays on same row as [overlapped1]

  @endgantt
#+END_SRC

#+RESULTS:
[[file:test.svg]]
